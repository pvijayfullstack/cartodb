(function(D){var B;function A(E){D("link[rel$=icon]").replaceWith("");D("head").append(D('<link rel="shortcut icon" type="image/x-icon"/>').attr("href",E));}D.favicon=function(F,H,G){if(arguments.length==2){G=H;}if(G){B=B||D("<canvas />")[0];if(B.getContext){var E=D("<img />")[0];E.onload=function(){D.favicon.unanimate();B.height=B.width=this.width;var I=B.getContext("2d");I.drawImage(this,0,0);G(I);A(B.toDataURL("image/png"));};E.src=F;}else{A(H||F);}}else{D.favicon.unanimate();A(F);}return this;};var C={timer:null,frames:[],size:16,count:1};D.extend(D.favicon,{animate:function(G,H,F){F=F||{};B=B||D("<canvas />")[0];if(B.getContext){var E=D("<img />")[0];E.onload=function(){D.favicon.unanimate();C.onStop=F.onStop;C.image=this;B.height=B.width=C.size=this.height;C.count=this.width/this.height;var K=[];for(var J=0;J<C.count;++J){K.push(J);}C.frames=F.frames||K;var I=B.getContext("2d");F.onStart&&F.onStart();C.timer=setInterval(function(){var M=C.frames.shift();C.frames.push(M);if(M>=C.count){clearInterval(C.timer);C.timer=null;throw new Error("jQuery.favicon.animate: frame #"+M+' do not exists in "'+G+'"');}var L=C.size;I.drawImage(C.image,L*M,0,L,L,0,0,L,L);F.onDraw&&F.onDraw(I,M);A(B.toDataURL("image/png"));},F.interval||1000);};E.src=G;}else{A(H||G);}},unanimate:function(){if(C.timer){clearInterval(C.timer);C.timer=null;C.onStop&&C.onStop();}}});})(jQuery);