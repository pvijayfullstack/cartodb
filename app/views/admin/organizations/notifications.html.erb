<% content_for :settings_body do %>
  <div class="FormAccount-container js-OrganizationNotification">
    <%= form_for @notification, url: CartoDB.url(self, 'new_organization_notification_admin', {}, current_user) do |f| %>
      <%= csrf_meta_tags %>

      <div class="FormAccount-row FormAccount-row--smallMarginBottom">
        <div class="FormAccount-rowLabel">
          <label class="CDB-Text CDB-Size-medium is-semibold u-mainTextColor">Notification Description</label>
        </div>
        <div class="FormAccount-rowData">
          <%= f.text_area :body, :class => "CDB-Textarea CDB-Text FormAccount-textarea FormAccount-input FormAccount-input--totalwidth" %>
        </div>
        <div class="FormAccount-rowInfo">
          <p class="FormAccount-rowInfoText"></p>
        </div>
      </div>

      <div class="OrganizationNotification-submissionRow ">
        <div class="FormAccount-rowData">
          <div class="CDB-Text CDB-Size-medium u-rSpace--xl">
            <label class="CDB-Text CDB-Size-medium is-semibold u-mainTextColor">Send to:</label>
            <% Carto::Notification::RECIPIENTS.each do |recipient| %>
              <input class="CDB-Radio" type="radio" name="carto_notification[recipients]" value="<%= recipient %>" <%= recipient == @notification.recipients ? 'checked' : '' %> required="true">
              <span class="u-iBlock CDB-Radio-face"></span>
              <label class="u-iBlock u-lSpace CDB-Text CDB-Size-medium u-secondaryTextColor is-semibold"><%= recipient.capitalize %></label>
            <% end %>
          </div>
        </div>
        <button type="submit" class="CDB-Button CDB-Button--primary">
          <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase">Send</span>
        </button>
      </div>
    <% end %>

    <div class="OrganizationNotifications">
      <div class="FormAccount-title">
        <p class="FormAccount-titleText">
          Past Notifications
          <span class="FormAccount-subtitleText">
            (stores up to 12 most recent notifications)
          </span>
        </p>
      </div>

      <span class="FormAccount-separator"></span>

      <ul class="NotificationsList">
        <% @notifications.each do |notification| %>
          <li class="NotificationsList-item js-NotificationsList-item">
            <div class="NotificationsList-itemCategory NotificationsList-itemCategory--<%= notification.icon %>">
            </div>

            <div class="NotificationsList-itemInfo">
              <div class="NotificationsList-itemPrimaryInfo">
                <div class="NotificationsList-itemTitle u-ellipsis CDB-Text CDB-Size-large u-mainTextColor js-html_body">
                  <%= raw notification.html_body %>
                </div>

                <div class="NotificationsList-itemDescription">
                  <p class="u-ellipsis CDB-Text CDB-Size-medium u-altTextColor"><abbr title="<%= notification.to_hash[:created_at] %>" class="u-rSpace--xl"><%= notification.to_hash[:created_at].strftime("%d/%m/%Y") %></abbr> User type: <span class="js-recipients" data-recipients="<%= notification.to_hash[:recipients] %>"><%= notification.to_hash[:recipients].capitalize %></span></p>
                </div>
              </div>

              <div class="NotificationsList-itemSecondaryInfo">
                <div class="NotificationsList-itemMeta CDB-Text CDB-Size-small">
                  <a href="#/resend" class="NotificationsList-itemLink js-resend">Resend</a>
                </div>

                <div class="NotificationsList-itemMeta CDB-Text CDB-Size-small">
                  <a href="#" class="NotificationsList-itemLink NotificationsList-itemLink--remove">Remove for all users</a>
                </div>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
<% end %>

<%= render template: 'admin/organizations/_organization_settings', locals: { title: 'notifications' } %>
